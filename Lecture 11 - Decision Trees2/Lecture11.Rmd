---
title: "Decision Trees"
subtitle: "Lecture 11"
author: "Pablo Benavides Herrera"
date: 2020-07-04
output: 
  html_notebook:
    toc: TRUE
    toc_float: TRUE
    highlight: tango
    theme: spacelab
---

```{r pkgs, message=FALSE}
library(tidyverse)
```

#

$$
\begin{aligned}
\operatorname{Entropy}(t) &=-\sum_{i=0}^{c-1} p(i \mid t) \log _{2} p(i \mid t) \\
\operatorname{Gini}(t) &=1-\sum_{i=0}^{c-1}[p(i \mid t)]^{2} \\
\text { Classification error }(t) &=1-\max _{i}[p(i \mid t)]
\end{aligned}
$$
Donde $c$ es {}

```{r impurity-measures}
impurity <- function(i){
  t <- sum(i)
  tibble(entropy =-sum(i/t * if_else(is.infinite(log2(i/t)),0,log2(i/t))),
         gini = 1 - sum((i/t)^2),
         `classification error` = 1 - max(i/t) 
         )
}
```

# Ejemplos

# Ejemplo 1
$$
\begin{aligned}
&\begin{array}{|c|c|}
\hline \text { Node } N_{1} & \text { Count } \\
\hline \text { Clitss }=0 & 0 \\
\hline \text { Class }=1 & 6 \\
\hline
\end{array}\\
&\begin{array}{|c|c|}
\hline \text { Node } N_{2} & \text { Count } \\
\hline \text { Class }=0 & 1 \\
\hline \text { Class }=1 & 5 \\
\hline
\end{array}\\
&\begin{array}{|c|c|}
\hline \text { Node } N_{3} & \text { Count } \\
\hline \text { Class }=0 & 3 \\
\hline \text { Class }=1 & 3 \\
\hline
\end{array}
\end{aligned}
$$


```{r}
nodos <- tibble(n1 = c(0,6),
                n2 = c(1,5),
                n3 = c(3,3))
nodos %>% 
  map_df(impurity) %>% 
  mutate(nodo = names(nodos)) %>% 
  select(nodo, everything())
```



$$
\Delta=I(\text { parent })-\sum_{j=1}^{k} \frac{N\left(v_{j}\right)}{N} I\left(v_{j}\right)
$$

where $I(.)$ is the impurity measure of a given node. $N$ is the total number of records at the parent node, $k$ is the number of attribute values, and $N(v_j)$ is the number of records associated with the child node, $v_j$.

![](Example2.PNG)


```{r}
# La entropÃ­a
impurity(c(3,3)) %>% 
  pull(entropy)
# Total de elementos y clases
t <- 6
clases <- 2 # + ^ -
example2 <- tibble(clase = c(1,1,1,
                             2,2,2),
                   color = c("b","r","r",
                             "g","r","g"),
                   size = c("big","big","big",
                            "small","small", "big")
                   )
example2
# Delta
# azul
example2 %>% filter(color == "b")
```
* Azul

$$
I(v_j) =- \frac{1}{1} \log_2(1) - 0\log_2(0) = 0
$$

* Rojo
```{r}
-2/3 * log2(2/3)-1/3*log2(1/3)
```
$$
I(v_j) =- \frac{2}{3} \log_2(2/3) - \frac{1}{3}  \log_2(\frac{1}{3}) = 0.9182958
$$

* Verde

$$
I(v_j) =- \frac{2}{2} \log_2(1) - 0/2 \log_2(0/2) = 0
$$

$$
\Delta = 1 - \left(\frac1 6 * 0 + \frac3 6 * 0.9182958 + \frac2 6 * 0 \right) = 0.59
$$






