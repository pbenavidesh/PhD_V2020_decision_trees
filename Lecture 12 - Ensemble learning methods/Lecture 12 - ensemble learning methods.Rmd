---
title: "Ensemble learning methods"
subtitle: "Bagging, Random Forests, Boosting"
author: "Pablo Benavides-Herrera"
date: 2020-07-07
output: 
  html_notebook:
    toc: TRUE
    toc_float: TRUE
    number_sections: TRUE
    highlight: tango
    theme: spacelab
---
# Prerrequisitos

```{r setup}
knitr::opts_chunk$set(echo = TRUE,results = "markup")
```


```{r pkgs, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(modeldata)
library(baguette)
```


# Bootstrap aggregating (Bagging)

* El objetivo de realizar *Bagging* es reducir la varianza de un árbol de decisión de clasificación.

* Se crean varios subconjuntos de datos de la muestra de entrenamiento, escogidos de forma aleatoria con reemplazo.

* Cada subconjunto se utiliza para entrenar su propio árbol de decisión. Como resultado, se obtiene una colección de distintos modelos.

* El promedio de las predicciones de todos los árboles es más robusto que el de uno solo.

## Ejemplo: `Biomass Data`

> Ghugare et al (2014) contains a data set where different biomass fuels are characterized by the amount of certain molecules (carbon, hydrogen, oxygen, nitrogen, and sulfur) and the corresponding higher heating value (HHV)

```{r}
data(biomass, package = "modeldata")
glimpse(biomass)
```

### Limpieza

Los datos de entrenamiento:

```{r}
biomass_tr <- biomass %>%
  filter(dataset == "Training") %>%
  select(-dataset, -sample)
biomass_tr
```

Los de validación:

```{r}
biomass_te <-
  biomass %>%
  filter(dataset == "Testing") %>%
  select(-dataset, -sample)
biomass_te
```

Utilizaremos el modelo "Multivariate adaptive regression splines (MARS)" junto con la función `bagger()` para crear 5 árboles de decisión con el método Bagging.

```{r}
#control	
#A list of options generated by control_bag().
ctrl <- control_bag(var_imp = TRUE)

# `times` is low to make the examples run faster
set.seed(7687)
# Using formulas
#  multivariate adaptive regression splines (MARS)
mars_bag <- bagger(HHV ~ ., data = biomass_tr, 
                   base_model = "MARS", times = 5,
                   control = ctrl)
mars_bag
```


Hacemos la predicción:

```{r}
predicciones <- predict(mars_bag, new_data = biomass_te)
predicciones
```

```{r}
biomass_te %>% 
  mutate(pred = predicciones$.pred) %>% 
  ggplot(aes(x = HHV, y = pred)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0)
```





